{"version":3,"sources":["webpack://xibo-cms/./modules/src/xibo-calendar-render.js"],"names":["jQuery","fn","extend","xiboCalendarRender","options","events","defaults","duration","previewWidth","previewHeight","scaleOverride","$","TODAY","moment","INITIAL_YEAR","year","INITIAL_MONTH","month","INITIAL_DATE","date","TIME_FORMAT","timeFormat","DEFAULT_DAY_START_TIME","startOf","format","DEFAULT_DAY_END_TIME","endOf","GRID_STEP","gridStep","DEFAULT_FONT_SIZE","DEFAULT_FONT_SCALE","textScale","maxEventPerDay","maxEventPerDayWithExtra","weekdaysNames","weekdays","weekdayNameLength","weekdaysMin","weekdaysShort","monthsNames","months","monthNameLength","monthsShort","createCalendar","addEventsToCalendar","applyStyleOptions","toggleClass","showHeader","excludeWeekendDays","css","mainBackgroundColor","gridColor","gridTextColor","dayBgColor","dayTextColor","todayTextColor","nowMarkerColor","dayOtherMonthBgColor","dayOtherMonthTextColor","headerBgColor","headerTextColor","weekDaysHeaderBgColor","weekDaysHeaderTextColor","eventBgColor","eventTextColor","dailyEventBgColor","dailyEventTextColor","multiDayEventBgColor","multiDayEventTextColor","aditionalEventsBgColor","aditionalEventsTextColor","noEventsBgColor","noEventsTextColor","getWeekday","weekday","createNowMarker","$container","timeData","dayViewDuration","end","start","$nowMarker","nowTimeInMinutes","diff","as","eventPositionPerc","appendTo","addEventsToCalendarBase","forEach","event","startDate","allDayEvent","isSame","endDate","allDay","subtract","eventTotalDays","currentDayOfEvent","momentAux","addEventToDay","add","getEventContainer","calendarType","find","getAllDayEventsContainer","$newEvent","weekDay","eventDuration","addClass","htmlToAdd","summary","html","remainingDays","$dailyEventsContainer","slots","data","daySlot","undefined","index","length","slot","push","dayAfter","$newContainer","dataSlots","updateContainerExtraEvents","$eventsContainer","containerData","eventData","eventHeightAdj","eventLevel","newLevel","level","eventHeight","height","parseFloat","prependTo","bodyFontSize","parseInt","split","singleEventHeight","extraEventsHeight","Math","floor","maxEventsForThisDay","numberOfExtendedEvents","filter","ev","idx","remove","numEventsToHide","numExtendedEventsFix","append","createCalendarHourGrid","gridSpacing","$calendarContainer","addedEvents","getDayContainer","$dayContainerTemp","$dayContainerTitle","attr","$dayContainer","$dayContainerEvents","showDescription","description","useDateRange","rangeStart","rangeEnd","showNowMarker","$dayEventsContainer","$targetElement","each","insertBefore","noEventsMessage","$hourGrid","$dayTitle","$weekDay","today","day","dayOfMonth","$dayOfMonthElement","startTime","endTime","$dayElement","$daysOfWeek","$calendarDays","currentWeekDays","createDaysForCurrentWeek","appendDay","startOfWeek","Array","map","dayOfWeek","currentMonthDays","previousMonthDays","nextMonthDays","createDaysForCurrentMonth","createDaysForPreviousMonth","createDaysForNextMonth","days","isCurrentMonth","getNumberOfDaysInMonth","daysInMonth","firstDayOfTheMonthWeekday","previousMonth","visibleNumberOfDaysFromPreviousMonth","previousMonthLastMondayDayOfMonth","lastDayOfTheMonthWeekday","nextMonth","visibleNumberOfDaysFromNextMonth"],"mappings":"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","file":"xibo-calendar-render.js","sourcesContent":["/**\n * Copyright (C) 2021 Xibo Signage Ltd\n *\n * Xibo - Digital Signage - http://www.xibo.org.uk\n *\n * This file is part of Xibo.\n *\n * Xibo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * Xibo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\n */\njQuery.fn.extend({\n  xiboCalendarRender: function(options, events) {\n    // Default options\n    const defaults = {\n      duration: '30',\n      previewWidth: 0,\n      previewHeight: 0,\n      scaleOverride: 0,\n    };\n\n    options = $.extend({}, defaults, options);\n\n    // Global constants\n    const TODAY = moment();\n\n    const INITIAL_YEAR = moment().year();\n\n    // NOTE: month format for momentjs is 1-12 and month value is zero indexed\n    const INITIAL_MONTH = moment().month();\n    const INITIAL_DATE = moment().date();\n\n    const TIME_FORMAT = options.timeFormat || 'HH:mm';\n\n    const DEFAULT_DAY_START_TIME = moment().startOf('day').format(TIME_FORMAT);\n    const DEFAULT_DAY_END_TIME = moment().endOf('day').format(TIME_FORMAT);\n\n    const GRID_STEP = options.gridStep &&\n      options.gridStep > 0 ? options.gridStep : 60;\n\n    const DEFAULT_FONT_SIZE = 16;\n    const DEFAULT_FONT_SCALE = options.textScale || 1;\n\n    // Global vars for all calendar types\n    let maxEventPerDay;\n    let maxEventPerDayWithExtra;\n\n    let weekdaysNames = moment.weekdays(true);\n    if (options.weekdayNameLength == 'short') {\n      weekdaysNames = moment.weekdaysMin(true);\n    } else if (options.weekdayNameLength == 'medium') {\n      weekdaysNames = moment.weekdaysShort(true);\n    }\n\n    let monthsNames = moment.months();\n    if (options.monthNameLength == 'short') {\n      monthsNames = moment.monthsShort();\n    }\n\n    // Main functions to be overriden\n    let createCalendar = () => {};\n    let addEventsToCalendar = () => {};\n\n    /**\n     * Apply style based on options\n     */\n    function applyStyleOptions() {\n      $('#content').toggleClass('hide-header', options.showHeader != '1');\n      $('#content').toggleClass('hide-weekend', options.excludeWeekendDays === '1');\n\n      $(':root').css('font-size', DEFAULT_FONT_SIZE * DEFAULT_FONT_SCALE);\n\n      options.mainBackgroundColor &&\n        $(':root').css('--main-background-color', options.mainBackgroundColor);\n\n      options.gridColor && $(':root').css('--grid-color', options.gridColor);\n      options.gridTextColor &&\n        $(':root').css('--grid-text-color', options.gridTextColor);\n\n      options.dayBgColor &&\n        $(':root').css('--day-bg-color', options.dayBgColor);\n      options.dayTextColor &&\n        $(':root').css('--day-text-color', options.dayTextColor);\n\n      options.todayTextColor &&\n        $(':root').css('--today-text-color', options.todayTextColor);\n\n      options.nowMarkerColor &&\n        $(':root').css('--now-marker-color', options.nowMarkerColor);\n\n      options.dayOtherMonthBgColor &&\n        $(':root').css(\n          '--day-other-month-bg-color',\n          options.dayOtherMonthBgColor,\n        );\n      options.dayOtherMonthTextColor &&\n        $(':root').css(\n          '--day-other-month-text-color',\n          options.dayOtherMonthTextColor,\n        );\n\n      options.headerBgColor &&\n        $(':root').css('--header-bg-color', options.headerBgColor);\n      options.headerTextColor &&\n        $(':root').css('--header-text-color', options.headerTextColor);\n\n      options.weekDaysHeaderBgColor &&\n        $(':root').css('--weekdays-bg-color', options.weekDaysHeaderBgColor);\n      options.weekDaysHeaderTextColor &&\n        $(':root').css(\n          '--weekdays-text-color',\n          options.weekDaysHeaderTextColor,\n        );\n\n      options.eventBgColor &&\n        $(':root').css('--event-bg-color', options.eventBgColor);\n      options.eventTextColor &&\n        $(':root').css('--event-text-color', options.eventTextColor);\n\n      options.dailyEventBgColor &&\n        $(':root').css('--daily-event-bg-color', options.dailyEventBgColor);\n      options.dailyEventTextColor &&\n        $(':root').css('--daily-event-text-color', options.dailyEventTextColor);\n\n      options.multiDayEventBgColor &&\n        $(':root').css(\n          '--multi-day-event-bg-color',\n          options.multiDayEventBgColor,\n        );\n      options.multiDayEventTextColor &&\n        $(':root').css(\n          '--multi-day-event-text-color',\n          options.multiDayEventTextColor,\n        );\n\n      options.aditionalEventsBgColor &&\n        $(':root').css(\n          '--aditional-events-bg-color',\n          options.aditionalEventsBgColor,\n        );\n      options.aditionalEventsTextColor &&\n        $(':root').css(\n          '--aditional-events-text-color',\n          options.aditionalEventsTextColor,\n        );\n\n      options.noEventsBgColor &&\n        $(':root').css(\n          '--no-events-bg-color',\n          options.noEventsBgColor,\n        );\n      options.noEventsTextColor &&\n        $(':root').css(\n          '--no-events-text-color',\n          options.noEventsTextColor,\n        );\n    }\n\n    /**\n     * Get week day number by date\n     * @param {string} date date string\n     * @return {number} week day number\n     */\n    function getWeekday(date) {\n      return moment(date).weekday() + 1;\n    }\n\n    /**\n     * Create a marker showing current time\n     * @param {object} $container target container\n     * @param {object} timeData data with start and end dates for the view\n     */\n    function createNowMarker($container, timeData) {\n      const dayViewDuration = timeData.end - timeData.start;\n      const $nowMarker = $('<div class=\"now-marker\">');\n\n      const nowTimeInMinutes = moment\n        .duration(\n          moment(TODAY).diff(\n            moment(TODAY).startOf('day'),\n          ),\n        )\n        .as('minutes');\n\n      // Skip if it's not included in the selected delta time view\n      if (\n        nowTimeInMinutes >= timeData.end ||\n        nowTimeInMinutes <= timeData.start\n      ) {\n        return;\n      }\n\n      // Calculate position\n      const eventPositionPerc = (\n        nowTimeInMinutes / dayViewDuration -\n        timeData.start / dayViewDuration\n      ) * 100;\n\n      $nowMarker.css(\n        'top',\n        eventPositionPerc + '%',\n      );\n\n      // Append marker to container\n      $nowMarker.appendTo($container);\n    }\n\n    /**\n     * Add events to calendar\n     */\n    function addEventsToCalendarBase() {\n      events.forEach((event) => {\n        const startDate = moment(event.startDate).startOf('date');\n\n        // Check if event is an all day\n        // (startDate 00:00 day 1, endDate 00:00 day after last day)\n        const allDayEvent =\n          moment(event.startDate).isSame(startDate) &&\n          moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\n        event.allDay = allDayEvent;\n\n        const endDate = allDayEvent ?\n          moment(event.endDate).startOf('date').subtract(1, 'd') :\n          moment(event.endDate).startOf('date');\n\n        const eventTotalDays = endDate.diff(startDate, 'days') + 1;\n        let currentDayOfEvent = 1;\n\n        // Days loop\n        const momentAux = moment(startDate);\n        while (momentAux <= endDate) {\n          addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\n          currentDayOfEvent++;\n          momentAux.add(1, 'd');\n        }\n      });\n    }\n\n    /**\n       * Add event to specific day\n       * @param {object} date  momentjs date\n       * @param {object} event\n       * @param {number} eventTotalDays\n       * @param {number} currentDayOfEvent\n       */\n    function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\n      /**\n       * Get container by date\n       * @param {object} date\n       * @return {object} Jquery container\n       */\n      function getEventContainer(date) {\n        return (options.calendarType == 2) ?\n          $('.calendar-day .calendar-events-container') :\n          $('#day_' + date.date()).find('.calendar-events-container');\n      }\n\n      /**\n       * Get all days container by date\n       * @param {object} date\n       * @return {object} Jquery container\n       */\n      function getAllDayEventsContainer(date) {\n        return (options.calendarType == 2) ?\n          $('.calendar-day .calendar-all-day-events-container') :\n          $('#day_' + date.date()).find('.calendar-all-day-events-container');\n      }\n\n      const $newEvent = $('<div class=\"calendar-event\">');\n      const weekDay = getWeekday(date);\n      let eventDuration = 1;\n\n      // Mark event as an all day\n      if (event.allDay) {\n        $newEvent.addClass('all-day');\n      }\n\n      if (eventTotalDays > 1) {\n        // Multiple day event\n        let htmlToAdd =\n          '<span class=\"event-summary\">' + event.summary + '</span>';\n\n        // Mark as multi event\n        $newEvent.addClass('multi-day');\n\n        // Draw only on the first day of the event\n        // or at the beggining of the weeks when it breaks\n        if (currentDayOfEvent == 1 || weekDay == 1) {\n          if (currentDayOfEvent == 1 && !event.allDay) {\n            htmlToAdd =\n              '<div class=\"event-time\">' +\n              moment(event.startDate).format(TIME_FORMAT) +\n              '</div>' +\n              htmlToAdd;\n          }\n\n          // Show event content in multiple days\n          $newEvent.html(htmlToAdd);\n\n          // Update element duration based on event duration\n          eventDuration = eventTotalDays - (currentDayOfEvent - 1);\n\n          const remainingDays = 8 - weekDay;\n          if (eventDuration > remainingDays) {\n            eventDuration = remainingDays;\n            $newEvent.addClass('cropped-event-end');\n          }\n\n          if (currentDayOfEvent > 1) {\n            $newEvent.addClass('cropped-event-start');\n          }\n          $newEvent.css(\n            'width',\n            'calc(' +\n            eventDuration * 100 +\n            '% + ' +\n            eventDuration * 2 +\n            'px)',\n          );\n        } else {\n          // Multiple event that was extended, no need to be rendered\n          return;\n        }\n      } else {\n        // Single day event\n        let htmlToAdd =\n          '<div class=\"event-summary\">' + event.summary + '</div>';\n\n        // Mark event as an all day\n        if (event.allDay) {\n          $newEvent.addClass('all-day');\n        } else {\n          htmlToAdd =\n            htmlToAdd +\n            '<div class=\"event-time\">' +\n            moment(event.startDate).format(TIME_FORMAT) +\n            ' - ' +\n            moment(event.endDate).format(TIME_FORMAT) +\n            '</div>';\n        }\n\n        // Add inner html\n        $newEvent.html(htmlToAdd);\n      }\n\n      // All day or multi day events\n      if (eventTotalDays > 1 || event.allDay) {\n        // If there's at least one daily event\n        // enable the container in the calendar view\n        $('.calendar-container').addClass('show-all-day-events');\n\n        const $dailyEventsContainer = getAllDayEventsContainer(date);\n\n        // Calculate event slot\n        let slots = $dailyEventsContainer.data('slots');\n        let daySlot;\n        if (slots != undefined) {\n          for (let index = 0; index < slots.length; index++) {\n            const slot = slots[index];\n            if (slot === undefined) {\n              daySlot = index;\n              slots[index] = 1;\n              break;\n            }\n          }\n\n          if (daySlot === undefined) {\n            daySlot = slots.length;\n            slots.push(1);\n          }\n        } else {\n          daySlot = 0;\n          slots = [1];\n        }\n\n        $dailyEventsContainer.data('slots', slots);\n\n        // Extend event to the remaining days\n        if (eventDuration > 1 && options.calendarType != 2) {\n          for (let dayAfter = 1; dayAfter < eventDuration; dayAfter++) {\n            const $newContainer = getAllDayEventsContainer(\n              moment(date).add(dayAfter, 'd'),\n            );\n            let dataSlots = $newContainer.data('slots');\n\n            if (dataSlots === undefined) {\n              dataSlots = [];\n            }\n\n            dataSlots[daySlot] = 2;\n            $newContainer.data('slots', dataSlots);\n          }\n        }\n\n        $newEvent.css('top', 1.875 * daySlot + 'rem');\n\n        // Append event to container\n        $newEvent.appendTo($dailyEventsContainer);\n\n        // Check container height and slots to show number of extra events\n        updateContainerExtraEvents($dailyEventsContainer, slots);\n      } else {\n        // Daily timed event\n        const $eventsContainer = getEventContainer(date);\n        const containerData = $('.hour-grid').data();\n\n        const dayViewDuration = containerData.end - containerData.start;\n        const eventData = {\n          start: moment\n            .duration(\n              moment(event.startDate).diff(\n                moment(event.startDate).startOf('day'),\n              ),\n            )\n            .as('minutes'),\n          duration: moment\n            .duration(moment(event.endDate).diff(moment(event.startDate)))\n            .as('minutes'),\n        };\n\n        // Skip event if it's not included in the selected delta time view\n        if (\n          eventData.start >= containerData.end ||\n          eventData.start + eventData.duration <= containerData.start\n        ) {\n          return;\n        }\n\n        // Calculate position\n        let eventPositionPerc = (\n          eventData.start / dayViewDuration -\n          containerData.start / dayViewDuration\n        ) * 100;\n        let eventHeightAdj = 0;\n\n        // Check if event starts before view time\n        if (eventPositionPerc < 0) {\n          $newEvent.addClass('before-view');\n          eventHeightAdj = eventPositionPerc;\n          eventPositionPerc = 0;\n        }\n\n        $newEvent.css(\n          'top',\n          eventPositionPerc + '%',\n        );\n\n        // Calculate event slot\n        let slots = $eventsContainer.data('slots');\n        let eventLevel = 0;\n        if (slots != undefined) {\n          let newLevel = 0;\n          for (let index = 0; index < slots.length; index++) {\n            const slot = slots[index];\n            if (\n              !(\n                eventData.start >= slot.end ||\n                eventData.start + eventData.duration <= slot.start\n              )\n            ) {\n              newLevel = slot.level + 1;\n            }\n          }\n\n          slots.push({\n            level: newLevel,\n            start: eventData.start,\n            end: eventData.start + eventData.duration,\n          });\n\n          eventLevel = newLevel;\n        } else {\n          slots = [\n            {\n              level: 0,\n              start: eventData.start,\n              end: eventData.start + eventData.duration,\n            },\n          ];\n\n          eventLevel = 0;\n        }\n\n        // Update container slots\n        $eventsContainer.data('slots', slots);\n\n        // Assign level\n        $newEvent.addClass('level-' + eventLevel);\n        $newEvent.toggleClass('concurrent', eventLevel > 0);\n\n        // Calculate height\n        const eventHeight = ((eventData.duration / dayViewDuration) * 100) +\n          eventHeightAdj;\n\n        $newEvent.height(eventHeight + '%');\n\n        // Append event to container\n        $newEvent.appendTo($eventsContainer);\n\n        // Mark shorter events to be styled\n        if ($newEvent.height() < parseFloat($newEvent.css('font-size')) * 2) {\n          $newEvent.addClass('shorter-event');\n          $newEvent.find('.event-time').prependTo($newEvent);\n        }\n      }\n    }\n\n    /**\n     * Update container and hide the number of extra events\n     * @param {object} $container jquery container\n     * @param {object} slots occupied slots\n     */\n    function updateContainerExtraEvents($container, slots) {\n      // Calculate max events per container (if not defined)\n      if (!maxEventPerDay) {\n        const bodyFontSize = parseInt(\n          $('body').css('font-size').split('px')[0],\n        );\n        const singleEventHeight =\n          bodyFontSize * 1.25 + bodyFontSize * 0.5 + bodyFontSize * 0.125;\n        const extraEventsHeight = bodyFontSize * 1.25 + bodyFontSize * 0.125;\n        maxEventPerDay = Math.floor($container.height() / singleEventHeight);\n\n        maxEventPerDayWithExtra = Math.floor(\n          ($container.height() - extraEventsHeight) / singleEventHeight,\n        );\n      }\n\n      // If we show extra. get number of events\n      // that fit inside that space ( smaller )\n      let maxEventsForThisDay = maxEventPerDay;\n      if (slots.length > maxEventPerDay) {\n        maxEventsForThisDay = maxEventPerDayWithExtra;\n      }\n\n      // Get number of dummy events that were generated\n      // by extended events in the visible elements\n      const numberOfExtendedEvents = slots.filter((ev, idx) => {\n        return ev == 2 && idx <= maxEventsForThisDay;\n      }).length;\n\n      // Remove extra elements\n      if (\n        maxEventsForThisDay > 0 &&\n        maxEventsForThisDay > numberOfExtendedEvents\n      ) {\n        $container\n          .find(\n            '.calendar-event:gt(' +\n            (maxEventsForThisDay - numberOfExtendedEvents - 1) +\n            ')',\n          )\n          .remove();\n      } else {\n        $container.find('.calendar-event').remove();\n      }\n\n      // Calculate number of events that were hidden\n      let numEventsToHide = 0;\n      for (let index = maxEventsForThisDay; index < slots.length; index++) {\n        if (slots[index] != undefined) {\n          numEventsToHide++;\n        }\n      }\n\n      // Fix for extended events\n      let numExtendedEventsFix = 0;\n      if (maxEventsForThisDay > 0 &&\n        maxEventsForThisDay < numberOfExtendedEvents) {\n        numExtendedEventsFix = numberOfExtendedEvents - maxEventsForThisDay;\n      }\n      numEventsToHide -= numExtendedEventsFix;\n\n      // Update extra events label\n      if (numEventsToHide > 0) {\n        if ($container.find('.extra-events').length > 0) {\n          $container.find('.extra-events span').html('+ ' + numEventsToHide);\n        } else {\n          $container.append(\n            '<div class=\"extra-events\"><span>+ ' +\n            numEventsToHide +\n            '</span></div>',\n          );\n        }\n      }\n    }\n\n    /**\n     * Create hour grid\n     * @param {object} $container jquery container\n     * @param {string} start\n     * @param {string} end\n     */\n    function createCalendarHourGrid($container, start, end) {\n      start =\n        start == '' ?\n          moment(DEFAULT_DAY_START_TIME, TIME_FORMAT) :\n          moment(start, TIME_FORMAT);\n      end =\n        end == '' ?\n          moment(DEFAULT_DAY_END_TIME, TIME_FORMAT) :\n          moment(end, TIME_FORMAT);\n\n      // Hour loop\n      const momentAux = moment(start);\n      while (momentAux <= end) {\n        $container.append(\n          '<li class=\"hour-time\">' + momentAux.format(TIME_FORMAT) + '</li>',\n        );\n        momentAux.add(GRID_STEP, 'm');\n      }\n\n      // Save properties to the container for later use\n      const containerData = {\n        start: moment\n          .duration(moment(start).diff(moment(start).startOf('day')))\n          .as('minutes'),\n        end: moment\n          .duration(moment(end).diff(moment(end).startOf('day')))\n          .as('minutes'),\n      };\n      $container.data(containerData);\n\n      // Calculate hour grid spacing\n      const gridSpacing =\n        (1 / ((containerData.end - containerData.start) / GRID_STEP)) * 100;\n      $container.find('.hour-time').height(gridSpacing + '%');\n    }\n\n    // Functions by calendar type\n    if (options.calendarType == 1) {\n      // Schedule View\n      const $calendarContainer = $('.calendar-container');\n      let addedEvents = 0;\n\n      /**\n       * Add event to specific day (override)\n       * @param {object} date  momentjs date\n       * @param {object} event\n       * @param {number} eventTotalDays\n       * @param {number} currentDayOfEvent\n       */\n      function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\n        /**\n         * Get container by date\n         * @param {object} date\n         * @return {object} Jquery container\n         */\n        function getDayContainer(date) {\n          let $dayContainerTemp;\n          let $dayContainerTitle;\n\n          if ($('#day_' + date.month() + '_' + date.date()).length > 0) {\n            $dayContainerTemp = $('#day_' + date.month() + '_' + date.date());\n          } else {\n            $dayContainerTemp = $('<div>').attr('id', 'day_' +\n              date.month() + '_' + date.date()).addClass('day-container');\n\n            $dayContainerTitle = $('<div class=\"title-container\">').appendTo(\n              $dayContainerTemp);\n\n            if (moment(date).startOf('d').isSame(moment(TODAY).startOf('d'))) {\n              $dayContainerTemp.addClass('today');\n            }\n\n            $('<div class=\"day-title-date\">' +\n              date.date() +\n              '</div>').appendTo($dayContainerTitle);\n\n            $('<div class=\"day-title-month\">' +\n              monthsNames[date.month()] +\n                '</div>').appendTo($dayContainerTitle);\n\n            $('<div class=\"day-title-weekday\">' +\n              weekdaysNames[date.weekday()] +\n              '</div>').appendTo($dayContainerTitle);\n\n            $('<div class=\"day-events\">').appendTo($dayContainerTemp);\n\n            $dayContainerTemp.appendTo($calendarContainer);\n          }\n\n          // $calendarContainer\n          return $dayContainerTemp;\n        }\n\n        const $newEvent = $('<div class=\"calendar-event\">');\n        const $dayContainer = getDayContainer(date);\n        const $dayContainerEvents = $dayContainer.find('.day-events');\n        let htmlToAdd = '';\n\n        // Add time\n        if (!event.allDay) {\n          if (currentDayOfEvent == 1) {\n            htmlToAdd +=\n              '<span class=\"event-start-time\">' +\n                moment(event.startDate).format(TIME_FORMAT) +\n              '</span>';\n\n            // Save start date to object data\n            $newEvent.data('start', event.startDate);\n\n            if (eventTotalDays == 1) {\n              htmlToAdd +=\n                ' - <span class=\"event-end-time\">' +\n                  moment(event.endDate).format(TIME_FORMAT) +\n                '</span>';\n            }\n          }\n        } else {\n          // Mark event as an all day\n          $newEvent.addClass('all-day');\n        }\n\n        // Mark event as a multi-day\n        if (eventTotalDays > 1) {\n          $newEvent.addClass('multi');\n        }\n\n        // Add summary\n        htmlToAdd += '<span class=\"event-summary\">' + event.summary + '</span>';\n\n        if (options.showDescription == 1 && event.description) {\n          htmlToAdd += '<div class=\"event-description\">' +\n            event.description + '</div>';\n        }\n\n        // Add inner html\n        $newEvent.html(htmlToAdd);\n\n        // Append event to container\n        if (event.allDay) {\n          $newEvent.prependTo($dayContainerEvents);\n        } else {\n          $newEvent.appendTo($dayContainerEvents);\n        }\n\n        addedEvents++;\n      }\n\n      // Override addEventsToCalendarBase\n      addEventsToCalendar = function(events) {\n        events.forEach((event) => {\n          const startDate = moment(event.startDate).startOf('date');\n\n          // Check if event is an all day\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\n          const allDayEvent =\n            moment(event.startDate).isSame(startDate) &&\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\n          event.allDay = allDayEvent;\n\n          const endDate = allDayEvent ?\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\n            moment(event.endDate).startOf('date');\n\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\n          let currentDayOfEvent = 1;\n\n          // Days loop\n          const momentAux = moment(startDate);\n\n          while (momentAux <= endDate) {\n            let startDate = null;\n            let endDate = null;\n\n            // If we're using a date range\n            // show only events from the start date onwards\n            // and before the end date\n            if (options.useDateRange == 1) {\n              (options.rangeStart) && (startDate = moment(options.rangeStart));\n              (options.rangeEnd) && (endDate = moment(options.rangeEnd));\n            } else {\n              startDate = moment(TODAY).startOf('d');\n            }\n\n            // Add event\n            if ((!startDate || moment(event.startDate) >= startDate) &&\n              (!endDate || moment(event.endDate) <= endDate)) {\n              addEventToDay(\n                momentAux,\n                event,\n                eventTotalDays,\n                currentDayOfEvent);\n            }\n\n            currentDayOfEvent++;\n            momentAux.add(1, 'd');\n          }\n        });\n\n        // Create now marker\n        if (options.showNowMarker == 1) {\n          const $nowMarker = $('<div class=\"now-marker\">');\n          const $dayEventsContainer = $calendarContainer.find('#day_' +\n            moment(TODAY).month() + '_' + moment(TODAY).date() +\n            ' .day-events');\n          let $targetElement;\n\n          if ($dayEventsContainer.length > 0) {\n            // Calculate position\n            $dayEventsContainer.find('.calendar-event').each((idx, event) => {\n              const start = $(event).data('start');\n\n              if (start && TODAY < moment(start)) {\n                $targetElement = $(event);\n                $nowMarker.insertBefore($targetElement);\n                return false;\n              }\n            });\n\n            // Append marker to container\n            if (!$targetElement) {\n              $nowMarker.appendTo($dayEventsContainer);\n            }\n          }\n        }\n\n        // Show no events message\n        if (options.noEventsMessage != '' && addedEvents == 0) {\n          $calendarContainer.append('<div class=\"no-events-message\">' +\n            options.noEventsMessage + '</div>');\n        }\n        // noEventsMessage\n      };\n    } else if (options.calendarType == 2) {\n      // Daily View\n      const $hourGrid = $('.hour-grid');\n      const $dayTitle = $('.day-title');\n      const $dayContainer = $('.day-container');\n\n      createCalendar = function() {\n        // Add day label\n        const $weekDay = $('<li>');\n        $dayTitle.append($weekDay);\n        $weekDay.html('<div class=\"week-day\">' +\n          weekdaysNames[TODAY.weekday()] +\n          '</div>');\n\n        const today = moment(TODAY);\n        const day = {\n          date: today.format('YYYY-MM-DD'),\n          dayOfMonth: today.date(),\n        };\n\n        const $dayOfMonthElement = $('<div class=\"week-day-date\">');\n        $dayOfMonthElement.html(day.dayOfMonth);\n        $weekDay.append($dayOfMonthElement);\n\n        // Add hour grid\n        createCalendarHourGrid($hourGrid, options.startTime, options.endTime);\n\n        // Add day element\n        const $dayElement = $('<li id=\"day_' + day.dayOfMonth + '\">');\n        $dayElement.addClass('calendar-day');\n\n        // Append all day events container\n        $dayElement.append(\n          $('<div class=\"calendar-all-day-events-container\">'),\n        );\n\n        // Append normal events container\n        $dayElement.append($('<div class=\"calendar-events-container\">'));\n\n        // Append day to container\n        $dayContainer.append($dayElement);\n\n        if (options.showNowMarker == 1) {\n          createNowMarker(\n            $dayElement.find('.calendar-events-container'),\n            $('.hour-grid').data(),\n          );\n        }\n      };\n\n      addEventsToCalendar = addEventsToCalendarBase;\n    } else if (options.calendarType == 3) {\n      // Weekly View\n      const $daysOfWeek = $('.day-of-week');\n      const $calendarDays = $('.days-row');\n      const $hourGrid = $('.hour-grid');\n\n      createCalendar = function() {\n        const year = INITIAL_YEAR;\n        const month = INITIAL_MONTH;\n        const date = INITIAL_DATE;\n\n        weekdaysNames.forEach((weekday, idx) => {\n          const $weekDay = $('<li id=\"' + idx + '\">');\n          $daysOfWeek.append($weekDay);\n          $weekDay.html('<div class=\"week-day\">' + weekday + '</div>');\n        });\n\n        // Add hour grid\n        createCalendarHourGrid($hourGrid, options.startTime, options.endTime);\n\n        // Remove all days\n        $calendarDays.find('.calendar-day').remove();\n\n        currentWeekDays = createDaysForCurrentWeek(year, month, date);\n\n        currentWeekDays.forEach((day) => {\n          appendDay(day, $calendarDays);\n        });\n      };\n\n      /**\n       * Create days for current week\n       * @param {string} year\n       * @param {string} month\n       * @param {string} date\n       * @return {array} Days of the week\n       */\n      function createDaysForCurrentWeek(year, month, date) {\n        const startOfWeek = moment({\n          year: year,\n          month: month,\n          date: date,\n        }).startOf('week');\n\n        return [...Array(7)].map((day, index) => {\n          const weekDay = moment(startOfWeek).add(index, 'd');\n          return {\n            date: weekDay.format('YYYY-MM-DD'),\n            dayOfMonth: weekDay.date(),\n            dayOfWeek: index,\n          };\n        });\n      }\n\n      /**\n       * Append new day\n       * @param {object} day\n       * @param {object} $calendarDays\n       */\n      function appendDay(day, $calendarDays) {\n        const $daysOfWeek = $('.day-of-week');\n        const $dayElement = $('<li id=\"day_' + day.dayOfMonth + '\">');\n        $dayElement.addClass('calendar-day');\n\n        // Append all day events container\n        $dayElement.append(\n          $('<div class=\"calendar-all-day-events-container\">'),\n        );\n\n        // Append normal events container\n        $dayElement.append($('<div class=\"calendar-events-container\">'));\n\n        // Append week day name element\n        const $dayOfMonthElement = $('<div class=\"week-day-date\">');\n        $dayOfMonthElement.html(day.dayOfMonth);\n        $daysOfWeek.find('#' + day.dayOfWeek).append($dayOfMonthElement);\n\n        $calendarDays.append($dayElement);\n\n        if (day.date === moment(TODAY).format('YYYY-MM-DD')) {\n          $daysOfWeek.find('#' + day.dayOfWeek).addClass('day-of-week--today');\n\n          if (options.showNowMarker == 1) {\n            createNowMarker(\n              $dayElement.find('.calendar-events-container'),\n              $('.hour-grid').data(),\n            );\n          }\n        }\n      }\n\n      // Override addEventsToCalendarBase\n      addEventsToCalendar = function(events) {\n        events.forEach((event) => {\n          const startDate = moment(event.startDate).startOf('date');\n\n          // Check if event is an all day\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\n          const allDayEvent =\n            moment(event.startDate).isSame(startDate) &&\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\n          event.allDay = allDayEvent;\n\n          const endDate = allDayEvent ?\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\n            moment(event.endDate).startOf('date');\n\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\n          let currentDayOfEvent = 1;\n\n          // Days loop\n          const momentAux = moment(startDate);\n          while (momentAux <= endDate) {\n            addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\n            currentDayOfEvent++;\n            momentAux.add(1, 'd');\n          }\n        });\n      };\n    } else if (options.calendarType == 4) {\n      // Monthly View\n      let currentMonthDays;\n      let previousMonthDays;\n      let nextMonthDays;\n\n      createCalendar = function() {\n        const $calendarDays = $('#calendarDays');\n        const year = INITIAL_YEAR;\n        const month = INITIAL_MONTH;\n        const $daysOfWeek = $('#daysOfWeek');\n\n        weekdaysNames.forEach((weekday) => {\n          const $weekDay = $('<li>');\n          $daysOfWeek.append($weekDay);\n          $weekDay.html(weekday);\n        });\n\n        $('#selectedMonth').html(\n          moment({\n            year: year,\n            month: month,\n          }).format('MMMM YYYY'),\n        );\n\n        // Remove all days\n        $calendarDays.find('.calendar-day').remove();\n\n        currentMonthDays = createDaysForCurrentMonth(year, month);\n\n        previousMonthDays = createDaysForPreviousMonth(year, month - 1);\n        nextMonthDays = createDaysForNextMonth(year, month + 1);\n\n        const days = [\n          ...previousMonthDays,\n          ...currentMonthDays,\n          ...nextMonthDays,\n        ];\n\n        days.forEach((day) => {\n          appendDay(day, $calendarDays);\n        });\n      };\n\n      /**\n       * Append new day\n       * @param {object} day\n       * @param {object} $calendarDays\n       */\n      function appendDay(day, $calendarDays) {\n        const $dayElement = $(\n          '<li id=\"day_' + day.month + '_' + day.dayOfMonth + '\">',\n        );\n        $dayElement.addClass('calendar-day');\n\n        // Append events container\n        const $eventsContainer = $('<div class=\"calendar-events-container\">');\n        $dayElement.append($eventsContainer);\n\n        // Append day\n        const $dayOfMonthElement = $('<span class=\"date\">');\n        $dayOfMonthElement.html(day.dayOfMonth);\n        $dayElement.append($dayOfMonthElement);\n\n        $calendarDays.append($dayElement);\n\n        if (!day.isCurrentMonth) {\n          $dayElement.addClass('calendar-day--not-current');\n        }\n\n        if (day.date === moment(TODAY).format('YYYY-MM-DD')) {\n          $dayElement.addClass('calendar-day--today');\n        }\n      }\n\n      /**\n       * Get the number of days in a given month\n       * @param {number} year\n       * @param {number} month\n       * @return {array} day objects\n       */\n      function getNumberOfDaysInMonth(year, month) {\n        return moment({\n          year: year,\n          month: month,\n        }).daysInMonth();\n      }\n\n      /**\n       * Create days on current month\n       * @param {number} year\n       * @param {number} month\n       * @return {array} day objects\n       */\n      function createDaysForCurrentMonth(year, month) {\n        return [...Array(getNumberOfDaysInMonth(year, month))].map(\n          (day, index) => {\n            return {\n              date: moment({\n                year: year,\n                month: month,\n                day: index + 1,\n              }).format('YYYY-MM-DD'),\n              dayOfMonth: index + 1,\n              month: month,\n              isCurrentMonth: true,\n            };\n          },\n        );\n      }\n\n      /**\n       * Create days in previous month\n       * @param {number} year\n       * @param {number} month\n       * @return {array} day objects\n       */\n      function createDaysForPreviousMonth(year, month) {\n        const firstDayOfTheMonthWeekday = getWeekday(currentMonthDays[0].date);\n\n        const previousMonth = moment({\n          year: year,\n          month: month - 1,\n        });\n\n        // Cover first day of the month\n        //  being sunday (firstDayOfTheMonthWeekday === 0)\n        const visibleNumberOfDaysFromPreviousMonth = firstDayOfTheMonthWeekday ?\n          firstDayOfTheMonthWeekday - 1 :\n          6;\n\n        const previousMonthLastMondayDayOfMonth = moment(\n          currentMonthDays[0].date,\n        )\n          .subtract(visibleNumberOfDaysFromPreviousMonth, 'day')\n          .date();\n\n        return [...Array(visibleNumberOfDaysFromPreviousMonth)].map(\n          (day, index) => {\n            return {\n              date: moment({\n                year: previousMonth.year(),\n                month: previousMonth.month(),\n                day: previousMonthLastMondayDayOfMonth + index,\n              }).format('YYYY-MM-DD'),\n              month: previousMonth.month(),\n              dayOfMonth: previousMonthLastMondayDayOfMonth + index,\n              isCurrentMonth: false,\n            };\n          },\n        );\n      }\n\n      /**\n       * Create days in next month\n       * @param {number} year\n       * @param {number} month\n       * @return {array} day objects\n       */\n      function createDaysForNextMonth(year, month) {\n        const lastDayOfTheMonthWeekday = getWeekday({\n          year: year,\n          month: month - 1,\n          date: currentMonthDays.length,\n        });\n\n        const nextMonth = moment({\n          year: year,\n          month: month,\n        });\n\n        const visibleNumberOfDaysFromNextMonth = lastDayOfTheMonthWeekday ?\n          7 - lastDayOfTheMonthWeekday :\n          lastDayOfTheMonthWeekday;\n\n        return [...Array(visibleNumberOfDaysFromNextMonth)].map(\n          (day, index) => {\n            return {\n              date: moment({\n                year: nextMonth.year(),\n                month: nextMonth.month(),\n                day: index + 1,\n              }).format('YYYY-MM-DD'),\n              month: nextMonth.month(),\n              dayOfMonth: index + 1,\n              isCurrentMonth: false,\n            };\n          },\n        );\n      }\n\n      addEventsToCalendar = function(events) {\n        events.forEach((event) => {\n          const startDate = moment(event.startDate).startOf('date');\n\n          // Check if event is an all day\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\n          const allDayEvent =\n            moment(event.startDate).isSame(startDate) &&\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\n          event.allDay = allDayEvent;\n\n          const endDate = allDayEvent ?\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\n            moment(event.endDate).startOf('date');\n\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\n\n          // Days loop\n          let currentDayOfEvent = 1;\n          const momentAux = moment(startDate);\n          while (momentAux <= endDate) {\n            addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\n            currentDayOfEvent++;\n            momentAux.add(1, 'd');\n          }\n        });\n      };\n\n      /**\n       * Add event to specific day (override)\n       * @param {object} date  momentjs date\n       * @param {object} event\n       * @param {number} eventTotalDays\n       * @param {number} currentDayOfEvent\n       */\n      function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\n        /**\n         * Get container by date\n         * @param {object} date\n         * @return {object} Jquery container\n         */\n        function getEventContainer(date) {\n          return $('#day_' + date.month() + '_' + date.date()).find(\n            '.calendar-events-container',\n          );\n        }\n\n        const $newEvent = $('<div class=\"calendar-event\">');\n        const $eventsContainer = getEventContainer(date);\n        const weekDay = getWeekday(date);\n        let eventDuration = 1;\n\n        // Mark event as an all day\n        if (event.allDay) {\n          $newEvent.addClass('all-day');\n        }\n\n        if (eventTotalDays > 1) {\n          // Multiple day event\n          let htmlToAdd =\n            '<span class=\"event-summary\">' + event.summary + '</span>';\n\n          // Mark as multi event\n          $newEvent.addClass('multi-day');\n\n          // Draw only on the first day of the event\n          // or at the beggining of the weeks when it breaks\n          if (currentDayOfEvent == 1 || weekDay == 1) {\n            if (currentDayOfEvent == 1 && !event.allDay) {\n              htmlToAdd =\n                '<span class=\"event-time\">' +\n                moment(event.startDate).format(TIME_FORMAT) +\n                '</span>' +\n                htmlToAdd;\n            }\n\n            // Show event content in multiple days\n            $newEvent.html(htmlToAdd);\n\n            // Update element duration based on event duration\n            eventDuration = eventTotalDays - (currentDayOfEvent - 1);\n\n            const remainingDays = 8 - weekDay;\n            if (eventDuration > remainingDays) {\n              eventDuration = remainingDays;\n              $newEvent.addClass('cropped-event-end');\n            }\n\n            if (currentDayOfEvent > 1) {\n              $newEvent.addClass('cropped-event-start');\n            }\n            $newEvent.css(\n              'width',\n              'calc(' +\n              eventDuration * 100 +\n              '% + ' +\n              eventDuration * 2 +\n              'px)',\n            );\n          } else {\n            // Multiple event that was extended, no need to be rendered\n            return;\n          }\n        } else {\n          // Single day event\n          let htmlToAdd =\n            '<span class=\"event-summary\">' + event.summary + '</span>';\n\n          // Mark event as an all day\n          if (event.allDay) {\n            $newEvent.addClass('all-day');\n          } else {\n            htmlToAdd =\n              '<span class=\"event-time\">' +\n              moment(event.startDate).format(TIME_FORMAT) +\n              '</span>' +\n              htmlToAdd;\n          }\n\n          // Add inner html\n          $newEvent.html(htmlToAdd);\n        }\n\n        // Calculate event slot\n        let slots = $eventsContainer.data('slots');\n        let daySlot;\n        if (slots != undefined) {\n          for (let index = 0; index < slots.length; index++) {\n            const slot = slots[index];\n            if (slot === undefined) {\n              daySlot = index;\n              slots[index] = 1;\n              break;\n            }\n          }\n\n          if (daySlot === undefined) {\n            daySlot = slots.length;\n            slots.push(1);\n          }\n        } else {\n          daySlot = 0;\n          slots = [1];\n        }\n\n        $eventsContainer.data('slots', slots);\n\n        // Extend event to the remaining days\n        if (eventDuration > 1) {\n          for (let dayAfter = 1; dayAfter < eventDuration; dayAfter++) {\n            const $newContainer = getEventContainer(\n              moment(date).add(dayAfter, 'd'),\n            );\n            let dataSlots = $newContainer.data('slots');\n\n            if (dataSlots === undefined) {\n              dataSlots = [];\n            }\n\n            dataSlots[daySlot] = 2;\n            $newContainer.data('slots', dataSlots);\n          }\n        }\n\n        $newEvent.css('top', 2 + 1.875 * daySlot + 'rem');\n\n        // Append event to container\n        $newEvent.appendTo($eventsContainer);\n\n        // Check container height and slots to show number of extra events\n        updateContainerExtraEvents($eventsContainer, slots);\n      }\n    }\n\n    // Create calendar\n    applyStyleOptions(options);\n    createCalendar();\n    addEventsToCalendar(events);\n\n    return true;\n  },\n});\n"],"sourceRoot":""}