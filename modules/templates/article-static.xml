<!--
  ~ Copyright (C) 2022 Xibo Signage Ltd
  ~
  ~ Xibo - Digital Signage - http://www.xibo.org.uk
  ~
  ~ This file is part of Xibo.
  ~
  ~ Xibo is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ any later version.
  ~
  ~ Xibo is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with Xibo.  If not, see <http://www.gnu.org/licenses/>.
  -->
<templates>
    <template>
        <id>article_custom_html</id>
        <type>static</type>
        <dataType>article</dataType>
        <title>Articles shown with custom HTML</title>
        <properties>
            <property id="effect" type="dropdown" mode="single">
                <title>Effect</title>
                <helpText>Please select the effect that will be used to transition between items. Marquee effects are CPU intensive and may not be suitable for lower power displays.</helpText>
                <default>noTransition</default>
                <options>
                    <option name="none">No effect - all items are shown</option>
                    <option name="marqueeLeft">Marquee Left</option>
                    <option name="marqueeRight">Marquee Right</option>
                    <option name="marqueeUp">Marquee Up</option>
                    <option name="marqueeDown">Marquee Down</option>
                    <option name="noTransition">No transition</option>
                    <option name="fade">Fade</option>
                    <option name="fadeout">Fade Out</option>
                    <option name="scrollHorz">Scroll Horizontal</option>
                    <option name="scrollVert">Scroll Vertical</option>
                    <option name="flipHorz">Flip Horizontal</option>
                    <option name="flipVert">Flip Vertical</option>
                    <option name="shuffle">Shuffle</option>
                    <option name="tileSlide">Tile Slide</option>
                    <option name="tileBlind">Tile Blind</option>
                </options>
            </property>
            <property id="speed" type="number">
                <title>Speed</title>
                <helpText>The transition speed of the selected effect in milliseconds (normal = 1000) or the Marquee Speed in a low to high scale (normal = 1)</helpText>
                <default>1000</default>
            </property>
            <property id="itemsSideBySide" type="checkbox">
                <title>Show items side by side?</title>
                <helpText>Should items be shown side by side?</helpText>
                <default>0</default>
            </property>
            <property id="itemsPerPage" type="number">
                <title>Items per page</title>
                <helpText>If an effect has been selected from the General tab, how many pages should we split the items across? If you don't enter anything here 1 item will be put on each page.</helpText>
                <default>1</default>
            </property>
            <property id="dateFormat" type="input" variant="dateFormat">
                <title>Date Format</title>
                <helpText>The format to apply to all dates returned by the Widget.</helpText>
                <default>#DATE_FORMAT#</default>
            </property>
            <property id="backgroundColor" type="color">
                <title>Background Colour</title>
                <helpText>The selected effect works best with a background colour. Optionally add one here.</helpText>
                <default></default>
            </property>
            <property id="textDirection" type="dropdown" mode="single">
                <title>Text direction</title>
                <helpText>Which direction does the text in the feed use?</helpText>
                <default>ltr</default>
                <options>
                    <option name="ltr">Left to Right (LTR)</option>
                    <option name="rtl">Right to Left (RTL)</option>
                </options>
            </property>
            <property id="ta_text" type="code" allowLibraryRefs="true" variant="html">
                <title>Item Template</title>
                <helpText>Enter text in the box below, used to display each article.</helpText>
            </property>
            <property id="noDataMessage" type="code" allowLibraryRefs="true" variant="html">
                <title>No data message</title>
                <helpText>A message to display when no data is returned from the source</helpText>
            </property>
            <property id="ta_css" type="code" allowLibraryRefs="true" variant="css">
                <title>Optional Stylesheet Template</title>
            </property>
            <property id="javaScript" type="code" allowLibraryRefs="true" variant="javascript">
                <title>Optional JavaScript</title>
            </property>
            <property id="copyright" type="input">
                <title>Copyright</title>
                <helpText>Copyright information to display as the last item in this feed.</helpText>
            </property>
        </properties>
        <stencil>
            <twig><![CDATA[
{% if javaScript %}<script type="text/javascript">{{javaScript}}</script>{% endif %}
{% if ta_css or itemsSideBySide or backgroundColor or textDirection == "rtl" %}
<style>
{% if itemsSideBySide %}.item, .page { float: left; }{% endif %}
{% if textDirection == "rtl" %}#content { direction: rtl; }{% endif %}
{% if backgroundColor %}body { background-color: {{backgroundColor}}; }{% endif %}
{{ta_css}}
</style>
{% endif %}
            ]]></twig>
        </stencil>
        <onRender><![CDATA[
// id: The id of the widget
// target: The target element to render
// items: The items to render
// properties: The properties for the widget
// globalOptions: The global rendering options
// -------------------------------------------
if (items.length > 0) {
    items = $(items).xiboSubstitutesParser(properties.ta_text, properties.dateFormat, ['date', 'publishedDate'], {
        description: 'summary',
        copyright: 'author',
    });
}

// No data message
if (items.length <= 0 && items.noDataMessage && items.noDataMessage !== '') {
    items.push(items.noDataMessage);
}

// Copyright
if (properties.copyright) {
    items.push(properties.copyright);
}

// Render
$(target).find('img').xiboImageRender(globalOptions);
$(target).xiboLayoutScaler(globalOptions);

var runOnVisible = function() {
    $(target).xiboTextRender(properties, items);
};

if (xiboIC.checkVisible()) {
    runOnVisible();
} else {
    xiboIC.addToQueue(runOnVisible);
}
        ]]></onRender>
    </template>
</templates>